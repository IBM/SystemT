------------------------------------------------------------
------------------------------------------------------------

create view PersonDisDict as
extract
	--dictionary 'disambiguation/person.dict'
	dictionary 'disambiguation/disambg_per_en.dict'
	on D.text
	as name
from Doc D
-- Sudarshan regex : 10/12/2011 - extended regex to include combination marks - line 12
--having MatchesRegex(/\p{Lu}.*/, name);
having MatchesRegex(/\p{Lu}\p{M}*.*/, name);

 
create view OrgDisDict as
extract
        --dictionary 'disambiguation/organization.dict'
        dictionary 'disambiguation/disambg_org_en.dict'
        on D.text
        as organization
from Doc D;

create view LocDisDict as
extract
        --dictionary 'disambiguation/location.dict'
        dictionary 'disambiguation/disambg_loc_en.dict'
        on D.text
        as loc
from Doc D;

------------------------------------------------------------
------------------------------------------------------------
create view NEDisDict as
	(select P.name as match, 'person' as type from PersonDisDict P)
	union all
	(select O.organization as match, 'org' as type from OrgDisDict O)
	union all
	(select L.loc as match, 'loc' as type from LocDisDict L);

create view POLEntities as
	(select P.person as match from PersonMixed P)
	union all
	(select O.organization as match from OrganizationMixed O)
	union all
	(select L.loc as match from LocationMixed L);

------------------------------------------------------------
------------------------------------------------------------
create view NEDisAlready as
select P1.*
from NEDisDict P1,
	 POLEntities P2
where Overlaps(P1.match, P2.match);

create view NEDisDictOnly as
	(select P.* from NEDisDict P)
	minus
	(select P.* from NEDisAlready P);	
	
create view SingleTokNEDisDictOnly as
select P.*
from NEDisDictOnly P
-- Sudarshan regex : 10/12/2011 - backreferences in lines 62 and 63
where Not(MatchesRegex(/(\p{Lu}\p{M}*|(,|in)).*\s+/, LeftContextTok(P.match, 1)))
  and Not(MatchesRegex(/\s+(\p{Lu}\p{M}*.*|,)/, RightContextTok(P.match, 1)));  
  
------------------------------------------------------------
------------------------------------------------------------
create view PersonMixedAll as
	(select P.person from PersonMixed P)
	union all
	(select P.match as person
	 from SingleTokNEDisDictOnly P
	 where Equals(GetText(P.type), 'person'));
	
create view Person_ as
select P.*
from PersonMixedAll P
consolidate on P.person; 
------------------------------------------------------------
------------------------------------------------------------

create view OrgMixedAll as
	(select P.* from OrganizationMixed P)
	union all
	(select P.match as organization, '' as type
	 from SingleTokNEDisDictOnly P
	 where Equals(GetText(P.type), 'org'));
	
create view Organization as
select P.*
from OrgMixedAll P
consolidate on P.organization; 
------------------------------------------------------------
------------------------------------------------------------

create view LocMixedAll as
	(select P.* from LocationMixed P)
	union all
	(select P.match as loc
	 from SingleTokNEDisDictOnly P
	 where Equals(GetText(P.type), 'loc'));
	
create view Location as
select P.loc
from LocMixedAll P
consolidate on P.loc; 
------------------------------------------------------------
------------------------------------------------------------
